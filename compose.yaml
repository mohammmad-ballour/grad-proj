services:
  pgvector:
    image: 'postgres:17-alpine'
    container_name: 'social-posgres'
    environment:
      - 'POSTGRES_DB=mydatabase'
      - 'POSTGRES_USER=mohbalor'
      - 'POSTGRES_PASSWORD=secret'
      - 'PGTZ=UTC'
    labels:
      - "org.springframework.boot.service-connection=postgres"
    ports:
      - '25432:5432'
    volumes:
      - social_data:/var/lib/postgresql/data  # Volume to persist data

  redis:
    image: 'redis:latest'
    container_name: 'social-redis'
    ports:
      - "16379:6379"
    restart: unless-stopped

  keycloak:
    container_name: 'social-keycloak'
    image: quay.io/keycloak/keycloak:latest
    ports:
      - '9090:8080'
    environment:
      - KEYCLOAK_ADMIN=mohbalor
      - KEYCLOAK_ADMIN_PASSWORD=secret
    volumes:
      - ./backend/keycloak-config/grad-proj-realm-export.json:/opt/keycloak/data/import/realm.json
    command:
      - "start-dev"
      - "--import-realm"

  ollama:
    container_name: 'social-ollama'
    image: 'ollama/ollama:latest'
    ports:
      - '11444:11434'
    volumes:
      - ollama_model_data:/root/.ollama
      - ./entrypoint.sh:/entrypoint.sh
    entrypoint: [ "/bin/bash", "/entrypoint.sh", "ollama", "serve" ]
    restart: always
    tty: true

volumes:
  social_data: # Define the volume
    driver: local
  ollama_model_data:
    driver: local
