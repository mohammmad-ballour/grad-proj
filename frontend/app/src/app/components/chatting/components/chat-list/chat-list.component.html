 <div class="flex-grow-1 overflow-auto" (click)="closeContextMenu()">

        <div class="text-center text-muted mt-4">
          @if(!loadingChats()) {
          <svg width="96" height="64" viewBox="0 0 96 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"
            style="margin: 0 auto; display: block;">
            <!-- chat bubble -->
            <rect x="8" y="4" rx="12" ry="12" width="80" height="44" fill="#f1f3f5" />
            <!-- tail -->
            <path d="M32 48 L38 40 L36 48 Z" fill="#f1f3f5" />
            <!-- animated dots -->
            <g transform="translate(18,18)" fill="#6c757d">
              <circle cx="6" cy="8" r="4">
                <animate attributeName="cy" values="8;4;8" dur="1s" repeatCount="indefinite" begin="0s" />
                <animate attributeName="opacity" values="0.3;1;0.3" dur="1s" repeatCount="indefinite" begin="0s" />
              </circle>
              <circle cx="22" cy="8" r="4">
                <animate attributeName="cy" values="8;2;8" dur="1s" repeatCount="indefinite" begin="0.12s" />
                <animate attributeName="opacity" values="0.3;1;0.3" dur="1s" repeatCount="indefinite" begin="0.12s" />
              </circle>
              <circle cx="38" cy="8" r="4">
                <animate attributeName="cy" values="8;4;8" dur="1s" repeatCount="indefinite" begin="0.24s" />
                <animate attributeName="opacity" values="0.3;1;0.3" dur="1s" repeatCount="indefinite" begin="0.24s" />
              </circle>
            </g>
          </svg>
          } @else if(chats().length === 0) {
          <i class="bi bi-chat-dots" style="font-size: 48px;"></i>
          <p class="mt-2">No chats available</p>
          }
        </div>


        @for (chat of filteredChats; track chat.chatId) {
        <div class="chat-item d-flex align-items-center p-2 border-bottom cursor-pointer" (click)="chatClicked(chat)"
          (contextmenu)="openContextMenu($event, chat)">

          <!-- Left: Avatar -->
          <div class="me-2">
            <img [src]="processImage(chat.chatPicture)" (error)="onImageError($event, 'assets/ProfileAvatar.png')"
              class="rounded-circle" width="50" height="50" alt="">
          </div>

          <!-- Middle: Chat Info -->
          <div class="flex-grow-1 d-flex flex-column overflow-hidden">
            <div class="d-flex justify-content-between align-items-center">
              <span class="fw-semibold text-truncate d-flex align-items-center gap-1" style="max-width: 70%;">
                {{ chat.name }}

                <!-- Pinned -->
                @if(chat.pinned) {
                <i style="color: rgb(26, 81, 175);" class="bi bi-pin-angle-fill"></i>
                }
              </span>

              <!-- Time -->
              <small class="text-muted">{{ chat.lastMessageTime | date:'HH:mm' }}</small>
            </div>

            <div class="d-flex justify-content-between align-items-center">
              <!-- Last message -->
              <small class="text-muted text-truncate" style="max-width: 70%;">
                <small class="text-muted text-truncate" style="max-width: 70%;">
                  @if(chat.messageType == 'IMAGE') {
                  photo <i class="bi bi-image-fill"></i>
                  } @else if(chat.messageType == 'VIDEO') {
                  video <i class="bi bi-camera-video-fill"></i>
                  } @else {
                  {{ wrapMessage(chat.lastMessage) }}
                  }
                </small>

              </small>

              <div class="d-flex align-items-center gap-1">
                <!-- Unread badge -->
                @if(chat.unreadCount) {
                <span class="badge bg-success rounded-pill px-2">{{ chat.unreadCount }}</span>
                }

                <!-- Muted -->
                @if(chat.muted) {
                <mat-icon class="text-muted" style="font-size: 16px;">notifications_off</mat-icon>
                }
              </div>
            </div>
          </div>

        </div>
        }

        <!-- Context Menu -->
        @if(contextMenuVisible) {
        <div class="position-fixed bg-white border rounded shadow p-2" [style.top.px]="contextMenuPosition.y"
          [style.left.px]="contextMenuPosition.x" style="z-index: 1000; width: 150px;">
          <button class="dropdown-item" (click)="togglePinChat(contextMenuChat)">
            {{ contextMenuChat.pinned ? 'Unpin' : 'Pin to Top' }}
          </button>
          <button class="dropdown-item" (click)="toggleMuteChat(contextMenuChat)">
            {{ contextMenuChat.muted ? 'Unmute' : 'Mute' }}
          </button>
          <button class="dropdown-item" (click)="deleteChat(contextMenuChat.chatId)">
            delete
          </button>
        </div>
        }

      </div>